# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ³ TRAS Phone - Docker Compose Configuration
# ÙŠØ¬Ù…Ø¹ Backend API & Admin Panel Ù…Ø¹Ø§Ù‹
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

services:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸš€ NestJS Backend API
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  tras-backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: tras-backend
    restart: unless-stopped
    expose:
      - '3000'
    env_file:
      - ./backend/.env
    depends_on:
      - tras-redis
    networks:
      - web-network
      - internal-network
    volumes:
      - ./backend/logs:/app/logs
      - ./backend/uploads:/app/uploads
    healthcheck:
      test: ["CMD", "node", "-e", "try { require('http').get('http://localhost:3000/api', (r) => process.exit(r.statusCode === 200 ? 0 : 1)) } catch (e) { process.exit(1) }"]
      interval: 30s
      timeout: 3s
      start_period: 40s
      retries: 3

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ“Š Admin Panel (React + Vite)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  tras-admin:
    build:
      context: ./admin
      dockerfile: Dockerfile
    container_name: tras-admin
    restart: unless-stopped
    expose:
      - '80'
    depends_on:
      - tras-backend
    networks:
      - web-network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 3s
      start_period: 10s
      retries: 3

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ”´ Redis Cache
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  tras-redis:
    image: redis:7-alpine
    container_name: tras-redis
    restart: unless-stopped
    expose:
      - '6379'
    volumes:
      - redis-data:/data
    networks:
      - internal-network
    command: redis-server --appendonly yes
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 3

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸŒ Networks
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
networks:
  # Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Nginx Proxy Manager
  web-network:
    external: true
  # Ø´Ø¨ÙƒØ© Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„ØªÙˆØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø§Øª
  internal-network:
    driver: bridge

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ’¾ Volumes
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
volumes:
  redis-data:
