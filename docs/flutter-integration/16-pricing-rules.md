# ๐ฐ ููุงุนุฏ ุงูุชุณุนูุฑ - ุฏููู ุงูุชูุงูู ูุน ุงูุชุทุจูู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูููุฑ ุงููุธุงู **ุชุณุนูุฑุงู ูุชุนุฏุฏ ุงููุณุชููุงุช** ุญุณุจ ููุน ุงูุนููู:

- ูู ุนููู ูุฑุจูุท ุจู **ูุณุชูู ุณุนุฑ** (Price Level) ูุซู: ุชุฌุฒุฆุฉุ ุฌููุฉุ VIP
- ูู ููุชุฌ ูููู ุฃู ูููู ูู **ุณุนุฑ ูุฎุชูู** ููู ูุณุชูู
- ุนูุฏ ุนุฏู ุชุญุฏูุฏ ุณุนุฑ ููุณุชูู ูุนููุ ููุทุจููู **ุฎุตู ุงููุณุจุฉ** (`discountPercentage`) ุนูู ุงูุณุนุฑ ุงูุฃุณุงุณู

---

## ๐ ุงูุฑุจุท ุจูู ุงูููููุงุช

```
ุงูุนููู (Customer) โ priceLevelId โ ูุณุชูู ุงูุณุนุฑ (Price Level)
                                    โ
ุงูููุชุฌ (Product) โ ProductPrice โ ุงูุณุนุฑ ุญุณุจ ุงููุณุชูู
                    ุฃู: basePrice - discountPercentage
```

---

## ๐ก API ุงูุชุบููุฑุงุช ูููุทูุฑ

### 1. ุงูููุชุฌุงุช - ุญูู `price` ุงูุฌุฏูุฏ

ุนูุฏูุง ูููู ุงููุณุชุฎุฏู **ูุณุฌูุงู** ููุฑุณู `Authorization: Bearer <token>` ูุน ุทูุจุงุช ุงูููุชุฌุงุชุ ูุฑุฌุน ุงูู API ุญูู **`price`** ุงุฎุชูุงุฑูุงู ูู ุงุณุชุฌุงุจุฉ ูู ููุชุฌ:

| ุงูุญูู            | ุงูููุน       | ุงููุตู                                               |
| ---------------- | ----------- | --------------------------------------------------- |
| `basePrice`      | number      | ุงูุณุนุฑ ุงูุฃุณุงุณู (ุฏุงุฆูุงู ููุฌูุฏ)                        |
| `compareAtPrice` | number?     | ุงูุณุนุฑ ูุจู ุงูุฎุตู ููุนุฑูุถ                              |
| **`price`**      | **number?** | **ุงูุณุนุฑ ุงููุนูู ููุนููู** (ูุธูุฑ ููุท ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู) |

**ุงูู Endpoints ุงููุชุฃุซุฑุฉ (ุชูุฑุณู ุงูุชููู ูุน ุงูุทูุจ):**

- `GET /products` - ูุงุฆูุฉ ุงูููุชุฌุงุช
- `GET /products/:identifier` - ุชูุงุตูู ุงูููุชุฌ
- `GET /products/featured`
- `GET /products/new-arrivals`
- `GET /products/best-sellers`
- `GET /products/on-offer`

**ูุซุงู ุงุณุชุฌุงุจุฉ ููุชุฌ (ุนููู ูุณุฌู):**

```json
{
  "id": "...",
  "name": "ุดุงุดุฉ ุขูููู 15",
  "basePrice": 500,
  "compareAtPrice": 550,
  "price": 450
}
```

**ุงุณุชุฌุงุจุฉ ููุณ ุงูููุชุฌ (ุถูู - ุจุฏูู ุชููู):**

```json
{
  "id": "...",
  "name": "ุดุงุดุฉ ุขูููู 15",
  "basePrice": 500,
  "compareAtPrice": 550
}
```

---

### 2. ุฅุถุงูุฉ ููุณูุฉ - ุงูุณุนุฑ ููุญุณุจ ูู ุงูุณูุฑูุฑ

**`POST /cart/items`** ูุง ูุนุชูุฏ ุนูู `unitPrice` ุงูููุฑุณู ูู ุงูุชุทุจูู. ุงูุณูุฑูุฑ ูุญุณุจ ุงูุณุนุฑ ุงูุตุญูุญ ุญุณุจ ูุณุชูู ุงูุนููู.

| ุงูุญูู       | ูุทููุจุ      | ุงููุตู                            |
| ----------- | ----------- | -------------------------------- |
| `productId` | ูุนู         | ูุนุฑูู ุงูููุชุฌ                     |
| `quantity`  | ูุนู         | ุงููููุฉ                           |
| `unitPrice` | **ุงุฎุชูุงุฑู** | **ููุชุฌุงูู** - ุงูุณูุฑูุฑ ูุญุณุจ ุงูุณุนุฑ |

**ูุซุงู ุทูุจ:**

```json
{
  "productId": "507f1f77bcf86cd799439011",
  "quantity": 2,
  "unitPrice": 0
}
```

ูููู ุฅุฑุณุงู `unitPrice` ููุชูุงูู ูุน ุงููุณุฎ ุงููุฏููุฉุ ูููู **ูู ููุณุชุฎุฏู**.

---

### 3. ุงูุทูุจ (Order) - ุญูู `priceLevelId`

ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ ุชุญุชูู ุนูู `priceLevelId` ูุชูุซูู ูุณุชูู ุงูุณุนุฑ ุงูููุณุชุฎุฏู:

```json
{
  "orderNumber": "ORD-2024-001",
  "customerId": "...",
  "priceLevelId": "507f1f77bcf86cd799439012",
  "subtotal": 900,
  "items": [...]
}
```

---

## ๐ฑ ุชูุตูุงุช ููุทูุฑ Flutter

### 1. ูููุฐุฌ ุงูููุชุฌ (Product Model)

ุฃุถู ุญูู `price` ุงุฎุชูุงุฑูุงู:

```dart
class ProductModel {
  final double basePrice;
  final double? compareAtPrice;
  /// ุงูุณุนุฑ ุงููุนูู ููุนููู (ูุธูุฑ ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู)
  final double? price;

  /// ุงูุณุนุฑ ุงููุนุฑูุถ: ุฅู ููุฌุฏ price ุงุณุชุฎุฏููุ ูุฅูุง basePrice
  double get effectivePrice => price ?? basePrice;
}
```

ูู `fromJson`:

```dart
price: json['price']?.toDouble(),
```

---

### 2. ุนุฑุถ ุงูุณุนุฑ ูู ุงููุงุฌูุฉ

ุงุณุชุฎุฏู `effectivePrice` ุจุฏูุงู ูู `basePrice` ูุนุฑุถ ุงูุณุนุฑ ูุฅุถุงูุฉ ุงูููุชุฌ ููุณูุฉ:

```dart
// ุนุฑุถ ุงูุณุนุฑ
Text('${product.effectivePrice} ุฑ.ุณ')

// ุฅุถุงูุฉ ููุณูุฉ ุงููุญููุฉ
context.read<CartCubit>().addToCartLocal(
  productId: product.id,
  quantity: _quantity,
  unitPrice: product.effectivePrice,  // ูููุณ product.basePrice
  ...
);
```

---

### 3. ุฅุฑุณุงู ุงูุชููู ูุน ุทูุจุงุช ุงูููุชุฌุงุช

ุชุฃูุฏ ุฃู `ApiClient` ููุฑุณู `Authorization: Bearer <token>` ูุน **ุฌููุน** ุทูุจุงุช ุงูููุชุฌุงุช ุนูุฏูุง ูููู ุงููุณุชุฎุฏู ูุณุฌูุงู. ุฃุบูุจ ุงูุชุทุจููุงุช ุชูุนู ุฐูู ุชููุงุฆูุงู ุนุจุฑ Interceptor.

ุจุฏูู ุชููู = ุงูุณุนุฑ ุงูุฃุณุงุณู ููุท  
ูุน ุชููู = ุญูู `price` ูู ุงูุงุณุชุฌุงุจุฉ (ุฅู ููุฌุฏ)

---

### 4. ุงูุณูุฉ - ุฅุถุงูุฉ ุนูุตุฑ

ุนูุฏ ุงุณุชุฏุนุงุก `POST /cart/items` ูููู ุฅุฑุณุงู `unitPrice: 0` ุฃู ุญุฐููุ ุงูุณูุฑูุฑ ุณูุญุณุจ ุงูุณุนุฑ ุงูุตุญูุญ:

```dart
await apiClient.post('/cart/items', data: {
  'productId': productId,
  'quantity': quantity,
  if (unitPrice != null) 'unitPrice': unitPrice,  // ุงุฎุชูุงุฑู
});
```

---

### 5. ุงููุฒุงููุฉ (syncCart)

`syncCart` ูุจูู ููุง ูู - ุงูุณูุฑูุฑ ูุชุญูู ูู ุงูุฃุณุนุงุฑ ููุตุญุญูุง. ุชุฃูุฏ ูู ุงุณุชุฏุนุงุก `syncCart()` ูุจู ุงูุฏูุน.

---

## ๐ ุงููููุงุช ุฐุงุช ุงูุตูุฉ

| ุงูููู                              | ุงูุชุนุฏูู ุงูููุชุฑุญ                            |
| ---------------------------------- | ------------------------------------------ |
| `product_model.dart`               | ุฅุถุงูุฉ `price` ู `effectivePrice`           |
| `product_entity.dart`              | ุฅุถุงูุฉ `price` ู `effectivePrice`           |
| `product_details_screen.dart`      | ุงุณุชุฎุฏุงู `effectivePrice` ุนูุฏ ุงูุฅุถุงูุฉ ููุณูุฉ |
| `product_offer_extension.dart`     | ุงุณุชุฎุฏุงู `effectivePrice` ููุนุฑูุถ            |
| `product_card.dart` / ูุงุฌูุงุช ุงูุนุฑุถ | ุนุฑุถ `effectivePrice`                       |

---

## โ ูุงุฆูุฉ ุงูุชุญูู ูููุทูุฑ

- [ ] ุฅุถุงูุฉ ุญูู `price` (double?) ุฅูู ProductModel ู ProductEntity
- [ ] ุฅุถุงูุฉ getter `effectivePrice` (price ?? basePrice)
- [ ] ุชุดุบูู `dart run build_runner build` ุจุนุฏ ุชุนุฏูู ุงูููุงุฐุฌ
- [ ] ุงุณุชุจุฏุงู `basePrice` ุจู `effectivePrice` ูู ุนุฑุถ ุงูุณุนุฑ
- [ ] ุงุณุชุจุฏุงู `basePrice` ุจู `effectivePrice` ุนูุฏ `addToCartLocal`
- [ ] ุงูุชุฃูุฏ ูู ุฅุฑุณุงู ุงูุชููู ูุน ุทูุจุงุช ุงูููุชุฌุงุช
- [ ] (ุงุฎุชูุงุฑู) ุฌุนู `unitPrice` ุงุฎุชูุงุฑูุงู ูู ุทูุจ ุฅุถุงูุฉ ุงูุณูุฉ
