# ğŸ“‹ Ù…Ø®Ø·Ø· Ø³ÙŠØ± Ø¹Ù…Ù„ÙŠØ© Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨

## ğŸ“ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙŠØ´Ø±Ø­ Ø¹Ù…Ù„ÙŠØ© Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ³ØªØ®Ø¯Ù… **Soft Delete** Ø­ÙŠØ« ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¥Ù„Ù‰ Ø­Ø§Ù„Ø© "Ù…Ø­Ø°ÙˆÙ" ÙˆÙŠÙ…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¯ÙˆÙ† Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙØ¹Ù„ÙŠØ§Ù‹.

Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØªØªÙƒÙˆÙ† Ù…Ù† **Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© Ø±Ø¦ÙŠØ³ÙŠØ©**:
1. Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠÙ‚Ø¯Ù… Ø·Ù„Ø¨ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
2. Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙ‚ÙˆÙ… Ø¨Ù€ Soft Delete Ù„Ù„Ø­Ø³Ø§Ø¨ ÙˆÙŠØ­ÙØ¸ Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
3. Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°ÙØŒ ÙŠØªÙ… Ù…Ù†Ø¹ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹

---

## ğŸ” Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©

### Ø·Ù„Ø¨ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ (Delete Account)

1. **`reason`** - Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
   - Ù†ÙˆØ¹: `string`
   - Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø£Ù‚ØµÙ‰: 500 Ø­Ø±Ù
   - Ø§Ù„ÙˆØµÙ: Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø°ÙŠ Ø¯ÙØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ù‡

**Ù…Ù„Ø§Ø­Ø¸Ø©**: Ø§Ù„Ø³Ø¨Ø¨ Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ù„ÙƒÙ† ÙŠÙÙ†ØµØ­ Ø¨Ø·Ù„Ø¨Ù‡ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙÙ‚ Ø³ÙŠØ§Ø³Ø© Google.

---

## ğŸ“Š Ù…Ø®Ø·Ø· Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ (Mermaid Flowchart)

```mermaid
%%{init: {'theme':'base', 'themeVariables': {'primaryTextColor':'#ffffff', 'primaryColor':'#2196F3', 'primaryBorderColor':'#1565C0', 'lineColor':'#9E9E9E', 'secondaryColor':'#2E7D32', 'tertiaryColor':'#F44336'}}}%%
flowchart TD
    Start([Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨]) --> Step1[Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ 'Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨']
    
    Step1 --> ShowDialog[Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø°Ù<br/>Ù…Ø¹ Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø¨Ø¨]
    
    ShowDialog --> InputReason[Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù<br/>- Ø§Ø®ØªÙŠØ§Ø±ÙŠ -]
    
    InputReason --> ConfirmDelete{Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¤ÙƒØ¯<br/>Ø§Ù„Ø­Ø°Ù?}
    
    ConfirmDelete -->|Ù„Ø§| Cancel[Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©]
    
    ConfirmDelete -->|Ù†Ø¹Ù…| CallAPI[Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API:<br/>DELETE /customer/profile]
    
    CallAPI --> BackendAuth[Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†<br/>ÙÙŠ Backend]
    
    BackendAuth --> GetCustomer[Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„<br/>Ø­Ø³Ø¨ userId Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†]
    
    GetCustomer --> ValidateCustomer{Ù‡Ù„ ÙŠÙˆØ¬Ø¯<br/>Ø¹Ù…ÙŠÙ„?}
    
    ValidateCustomer -->|Ù„Ø§| Error1[Ø®Ø·Ø£: Customer profile not found<br/>Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯]
    
    ValidateCustomer -->|Ù†Ø¹Ù…| UpdateUser[ØªØ­Ø¯ÙŠØ« User:<br/>status = 'deleted'<br/>deletedAt = Ø§Ù„Ø¢Ù†<br/>deletionReason = Ø§Ù„Ø³Ø¨Ø¨]
    
    UpdateUser --> SoftDeleteCustomer[Soft Delete Ù„Ù„Ù€ Customer Profile<br/>customer.deleteOne]
    
    SoftDeleteCustomer --> ReturnSuccess[Ø¥Ø±Ø¬Ø§Ø¹ Ù†Ø¬Ø§Ø­ 200<br/>Account deleted successfully]
    
    ReturnSuccess --> LogoutUser[ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…<br/>ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹]
    
    LogoutUser --> ClearData[Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©<br/>Tokens, Cache]
    
    ClearData --> RedirectLogin[Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø©<br/>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„]
    
    RedirectLogin --> End([Ù†Ù‡Ø§ÙŠØ© - ØªÙ… Ø­Ø°Ù<br/>Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­])
    
    Error1 --> ShowError[Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£<br/>ÙÙŠ App]
    
    ShowError --> EndError([Ø¥Ù†Ù‡Ø§Ø¡ - Ø®Ø·Ø£])
    Cancel --> EndError
```

---

## ğŸ”„ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ

### 1ï¸âƒ£ Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ (Delete Account)

#### Ø£) Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø°Ù

ÙŠØªÙ… Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:
- Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø­Ø³Ø§Ø¨ÙƒØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡."
- Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ): "Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù"
- Ø²Ø± Ø¥Ù„ØºØ§Ø¡
- Ø²Ø± Ø­Ø°Ù (Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±)

#### Ø¨) Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†

```typescript
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªÙˆÙƒÙ† ÙÙŠ JwtAuthGuard
const token = request.headers.authorization?.split(' ')[1];
const user = await jwtService.verify(token);
```

#### Ø¬) Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„

```typescript
// Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø­Ø³Ø¨ userId Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†
const customer = await customerModel.findOne({ userId: user.id });

if (!customer) {
  throw NotFoundException('Customer profile not found');
}
```

**âŒ Ø§Ù„Ø®Ø·Ø£ 1: Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯**
- Ø§Ù„Ø±Ø³Ø§Ù„Ø©: `"Customer profile not found"`
- Ø§Ù„ÙƒÙˆØ¯: 404

#### Ø¯) ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Soft Delete)

```typescript
// ØªØ­Ø¯ÙŠØ« User: Soft Delete
const userId = typeof customer.userId === 'object' && customer.userId?._id
  ? customer.userId._id.toString()
  : customer.userId.toString();

await usersService.delete(userId, reason);

// ÙÙŠ UsersService.delete()
user.status = 'deleted';
user.deletedAt = new Date();
if (reason) {
  user.deletionReason = reason;
}
await user.save();
```

**Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø­Ø¯Ø«Ø©**:
- `status`: ÙŠØªØºÙŠØ± Ù…Ù† `'active'` Ø¥Ù„Ù‰ `'deleted'`
- `deletedAt`: ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
- `deletionReason`: ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ø¨Ø¨ Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡

#### Ù‡Ù€) Soft Delete Ù„Ù„Ù€ Customer Profile

```typescript
// Soft Delete Ù„Ù„Ù€ Customer Profile
await customer.deleteOne();
```

**Ù…Ù„Ø§Ø­Ø¸Ø©**: `deleteOne()` ÙÙŠ Mongoose ÙŠÙ‚ÙˆÙ… Ø¨Ù€ Soft Delete Ø¥Ø°Ø§ ÙƒØ§Ù† Schema ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ `timestamps` Ùˆ `deletedAt`ØŒ ÙˆØ¥Ù„Ø§ ÙŠÙ‚ÙˆÙ… Ø¨Ø­Ø°Ù ÙØ¹Ù„ÙŠ.

#### Ùˆ) Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©

```json
{
  "success": true,
  "data": null,
  "message": "Account deleted successfully",
  "messageAr": "ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­"
}
```

---

### 2ï¸âƒ£ Ø§Ù„Ø®Ø·ÙˆØ© 2: Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù

Ø¨Ø¹Ø¯ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ØŒ ÙŠØªÙ… Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:

#### Ø£) Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„

```typescript
// ÙÙŠ AuthService.login()
const user = await userModel.findOne({ phone }).select('+password');

if (!user) {
  throw UnauthorizedException('Invalid credentials');
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
if (user.status === 'deleted') {
  await this.logLoginAttempt({
    identifier: phone,
    identifierType: 'phone',
    ipAddress: ipAddress || 'unknown',
    userAgent,
    status: 'blocked',
    failureReason: 'Account deleted',
  });
  throw UnauthorizedException('Your account has been deleted');
}
```

**âŒ Ø§Ù„Ø®Ø·Ø£ 2: Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ Ø­Ø³Ø§Ø¨ Ù…Ø­Ø°ÙˆÙ**
- Ø§Ù„Ø±Ø³Ø§Ù„Ø©: `"Your account has been deleted"`
- Ø§Ù„ÙƒÙˆØ¯: 401
- Ø§Ù„Ø­Ø§Ù„Ø©: `blocked` ÙÙŠ Ø³Ø¬Ù„ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„

---

### 3ï¸âƒ£ Ø§Ù„Ø®Ø·ÙˆØ© 3: ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡

Ø¨Ø¹Ø¯ Ù†Ø¬Ø§Ø­ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø°Ù ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:

#### Ø£) ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ

```dart
// ÙÙŠ Mobile App Ø¨Ø¹Ø¯ Ù†Ø¬Ø§Ø­ Ø§Ù„Ø­Ø°Ù
context.read<AuthCubit>().logout();
```

#### Ø¨) Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©

```dart
// Ù…Ø³Ø­ Tokens Ùˆ Cache
await localStorage.clear();
await secureStorage.clear();
```

#### Ø¬) Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡

```dart
// Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
context.go('/login');
```

---

## ğŸ“Œ Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØ§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©

### Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨

| # | Ø§Ù„Ø­Ø§Ù„Ø© | Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ | Ø§Ù„ÙƒÙˆØ¯ | ÙˆØµÙ |
|---|--------|-------------|-------|------|
| 1 | Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ | `Customer profile not found` | 404 | Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… |
| 2 | ØºÙŠØ± Ù…ØµØ±Ø­ | `Unauthorized` | 401 | Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© |

### Ø§Ù„Ø®Ø·ÙˆØ© 2: Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù

| # | Ø§Ù„Ø­Ø§Ù„Ø© | Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ | Ø§Ù„ÙƒÙˆØ¯ | ÙˆØµÙ |
|---|--------|-------------|-------|------|
| 3 | Ø­Ø³Ø§Ø¨ Ù…Ø­Ø°ÙˆÙ | `Your account has been deleted` | 401 | Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø­Ø³Ø§Ø¨ Ù…Ø­Ø°ÙˆÙ |

---

## ğŸ”’ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù†

### Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨

- **Soft Delete**: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§ ØªÙØ­Ø°Ù ÙØ¹Ù„ÙŠØ§Ù‹ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- **Ø§Ù„Ø­ÙØ¸**: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙØ­ÙØ¸ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©
- **Ø§Ù„Ø³Ø¨Ø¨**: ÙŠÙÙ†ØµØ­ Ø¨Ø­ÙØ¸ Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø©
- **Ø§Ù„ØªØ­Ù‚Ù‚**: ÙŠØ¬Ø¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ† Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø°Ù
- **Ø§Ù„ØªØ£ÙƒÙŠØ¯**: ÙŠØ¬Ø¨ Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø°Ù

### Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„

- **Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ**: ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ `AuthService.login()`
- **Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©**: `pending`, `active`, `suspended`, `deleted`
- **ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª**: ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©

### Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©

- **User Schema**: 
  - `status`: ÙŠØªØºÙŠØ± Ø¥Ù„Ù‰ `'deleted'`
  - `deletedAt`: ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
  - `deletionReason`: ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ø¨Ø¨ (Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡)
- **Customer Schema**: ÙŠØªÙ… Soft Delete Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… `deleteOne()`

---

## ğŸ¯ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Hard Delete Ùˆ Soft Delete

### Hard Delete (Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙØ¹Ù„ÙŠ)
- ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- ÙŠÙØ³ØªØ®Ø¯Ù… Ù„Ù„Ø£Ù…Ø§Ù† Ø£Ùˆ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø§Ù„ØµØ§Ø±Ù…

### Soft Delete (Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù„ÙŠÙ†)
- ÙŠØªÙ… ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙ‚Ø·
- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¨Ù‚Ù‰ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
- **ÙŠØ³ØªØ®Ø¯Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù…** Ø­Ø³Ø¨ Ø³ÙŠØ§Ø³Ø© Google

---

## ğŸ“Š Ù…Ø®Ø·Ø· ØªØ¯ÙÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Sequence Diagram)

```mermaid
%%{init: {'theme':'base', 'themeVariables': {'primaryTextColor':'#ffffff', 'primaryColor':'#2196F3', 'primaryBorderColor':'#1565C0', 'lineColor':'#9E9E9E', 'secondaryColor':'#2E7D32', 'tertiaryColor':'#F44336'}}}%%
sequenceDiagram
    participant U as Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    participant M as Mobile App
    participant API as Backend API
    participant CS as CustomersService
    participant US as UsersService
    participant DB as Database
    
    U->>M: Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ 'Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨'
    M->>U: Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø¨Ø¨
    U->>M: Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø¨Ø¨ + ØªØ£ÙƒÙŠØ¯
    
    M->>API: DELETE /customer/profile<br/>{reason: "..."}
    
    API->>API: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ† (JWT)
    API->>CS: deleteAccount(customerId, reason)
    
    CS->>DB: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Customer<br/>findByUserId(userId)
    DB-->>CS: Customer Object
    
    CS->>US: delete(userId, reason)
    
    US->>DB: ØªØ­Ø¯ÙŠØ« User:<br/>status='deleted',<br/>deletedAt=now,<br/>deletionReason=reason
    DB-->>US: User Ù…Ø­Ø¯Ø«
    
    US-->>CS: ØªÙ… Ø§Ù„Ø­Ø°Ù
    CS->>DB: Soft Delete Customer<br/>customer.deleteOne()
    DB-->>CS: ØªÙ… Ø§Ù„Ø­Ø°Ù
    
    CS-->>API: Ù†Ø¬Ø§Ø­
    API-->>M: 200 OK
    
    M->>M: ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬<br/>logout()
    M->>M: Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
    M->>U: Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
```

---

## ğŸ”— Ù…Ø±Ø§Ø¬Ø¹

### API Endpoints (Customer)

- `DELETE /customer/profile` - Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨
  - **Headers**: `Authorization: Bearer <accessToken>`
  - **Body** (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):
    ```json
    {
      "reason": "Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
    }
    ```
  - **Response**:
    ```json
    {
      "success": true,
      "data": null,
      "message": "Account deleted successfully",
      "messageAr": "ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­"
    }
    ```

### API Endpoints (Authentication)

- `POST /auth/login` - Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  - **Error Response** (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø­Ø°ÙˆÙ):
    ```json
    {
      "success": false,
      "message": "Your account has been deleted",
      "messageAr": "ØªÙ… Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ. Ø§Ù„Ø­Ø§Ù„Ø©: Ù…Ø­Ø°ÙˆÙ"
    }
    ```

---

## ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©

### Ø³ÙŠØ§Ø³Ø© Google Ù„Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨

ÙˆÙÙ‚ Ø³ÙŠØ§Ø³Ø© GoogleØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙˆÙØ±:
- âœ… **Ù‚Ø³Ù… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨** - Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
- âœ… **ÙˆØ§Ø¬Ù‡Ø© Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨** - Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø¹ Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø¨Ø¨
- âœ… **ØªÙˆØ¶ÙŠØ­ Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù** - Ø­Ù‚Ù„ Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø¨Ø¨
- âœ… **Soft Delete** - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§ ØªÙØ­Ø°Ù ÙØ¹Ù„ÙŠØ§Ù‹
- âœ… **Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„** - Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø­Ø°ÙˆÙ Ù„Ø§ ÙŠØ³ØªØ·ÙŠØ¹ Ø§Ù„Ø¯Ø®ÙˆÙ„

### Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©

Ø¨Ø¹Ø¯ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ØŒ ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù€:
- âœ… Ø¨ÙŠØ§Ù†Ø§Øª User (Ù…Ø¹ `status: 'deleted'`)
- âœ… Ø¨ÙŠØ§Ù†Ø§Øª Customer Profile
- âœ… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø°Ù (`deletedAt`)
- âœ… Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù (`deletionReason` - Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡)

### Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…ÙŠØ©

Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø­Ø°ÙˆÙ Ù„Ø§ ÙŠØ³ØªØ·ÙŠØ¹:
- âŒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
- âŒ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø£ÙŠ ÙˆØ¸Ø§Ø¦Ù ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
- âŒ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ (ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)

---

## ğŸ› ï¸ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠ

### Backend Implementation

**File**: `backend/src/modules/customers/customer-profile.controller.ts`

```typescript
@Delete('profile')
async deleteAccount(
  @CurrentUser() user: any,
  @Body() dto: DeleteAccountDto,
) {
  const customer = await this.customersService.findByUserId(user.id);
  
  if (!customer) {
    throw new NotFoundException('Customer profile not found');
  }
  
  await this.customersService.deleteAccount(
    customer._id.toString(),
    dto.reason,
  );
  
  return ResponseBuilder.success(
    null,
    'Account deleted successfully',
    'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­',
  );
}
```

### Mobile Implementation

**File**: `mobile/lib/features/settings/presentation/screens/settings_screen.dart`

```dart
void _showDeleteAccountDialog() {
  final reasonController = TextEditingController();
  final profileCubit = getIt<ProfileCubit>();

  showDialog(
    context: context,
    builder: (ctx) => BlocProvider.value(
      value: profileCubit,
      child: AlertDialog(
        title: const Text('Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨'),
        content: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            const Text('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø­Ø³Ø§Ø¨ÙƒØŸ'),
            TextField(
              controller: reasonController,
              decoration: InputDecoration(
                labelText: 'Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)',
              ),
              maxLines: 3,
            ),
          ],
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(ctx),
            child: Text('Ø¥Ù„ØºØ§Ø¡'),
          ),
          ElevatedButton(
            onPressed: () async {
              final success = await profileCubit.deleteAccount(
                reason: reasonController.text.trim().isEmpty 
                  ? null 
                  : reasonController.text.trim()
              );
              
              if (success) {
                context.read<AuthCubit>().logout();
                context.go('/login');
              }
            },
            child: const Text('Ø­Ø°Ù'),
          ),
        ],
      ),
    ),
  );
}
```

---

## âœ… Ø§Ù„Ø®Ù„Ø§ØµØ©

Ù†Ø¸Ø§Ù… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:
- âœ… ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø³ÙŠØ§Ø³Ø© Google
- âœ… ÙŠØ³ØªØ®Ø¯Ù… Soft Delete Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- âœ… ÙŠØ­ÙØ¸ Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø°Ù Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
- âœ… ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
- âœ… ÙŠÙˆÙØ± ÙˆØ§Ø¬Ù‡Ø© Ø³Ù„Ø³Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
